<!DOCTYPE html>
<html>
<head>
<title>code listings</title>
<link href="bootstrap/css/bootstrap.css" rel="stylesheet">
<link href="bootstrap/css/bootstrap-theme.css" rel="stylesheet">
<link href="css/index.css" rel="stylesheet">
<script src="bootstrap/js/bootstrap.js" type="text/javascript"></script>
<script src="js/jquery.min.js" type="text/javascript"></script>

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@kerseykyle">
<meta name="twitter:title" content="sha1.c">

<style>
    .source .hll { background-color: #ffffcc }
.source  { background: #f8f8f8; }
.source .c { color: #408080; font-style: italic } /* Comment */
.source .err { border: 1px solid #FF0000 } /* Error */
.source .k { color: #008000; font-weight: bold } /* Keyword */
.source .o { color: #666666 } /* Operator */
.source .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.source .cp { color: #BC7A00 } /* Comment.Preproc */
.source .c1 { color: #408080; font-style: italic } /* Comment.Single */
.source .cs { color: #408080; font-style: italic } /* Comment.Special */
.source .gd { color: #A00000 } /* Generic.Deleted */
.source .ge { font-style: italic } /* Generic.Emph */
.source .gr { color: #FF0000 } /* Generic.Error */
.source .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.source .gi { color: #00A000 } /* Generic.Inserted */
.source .go { color: #888888 } /* Generic.Output */
.source .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.source .gs { font-weight: bold } /* Generic.Strong */
.source .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.source .gt { color: #0044DD } /* Generic.Traceback */
.source .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.source .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.source .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.source .kp { color: #008000 } /* Keyword.Pseudo */
.source .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.source .kt { color: #B00040 } /* Keyword.Type */
.source .m { color: #666666 } /* Literal.Number */
.source .s { color: #BA2121 } /* Literal.String */
.source .na { color: #7D9029 } /* Name.Attribute */
.source .nb { color: #008000 } /* Name.Builtin */
.source .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.source .no { color: #880000 } /* Name.Constant */
.source .nd { color: #AA22FF } /* Name.Decorator */
.source .ni { color: #999999; font-weight: bold } /* Name.Entity */
.source .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.source .nf { color: #0000FF } /* Name.Function */
.source .nl { color: #A0A000 } /* Name.Label */
.source .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.source .nt { color: #008000; font-weight: bold } /* Name.Tag */
.source .nv { color: #19177C } /* Name.Variable */
.source .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.source .w { color: #bbbbbb } /* Text.Whitespace */
.source .mf { color: #666666 } /* Literal.Number.Float */
.source .mh { color: #666666 } /* Literal.Number.Hex */
.source .mi { color: #666666 } /* Literal.Number.Integer */
.source .mo { color: #666666 } /* Literal.Number.Oct */
.source .sb { color: #BA2121 } /* Literal.String.Backtick */
.source .sc { color: #BA2121 } /* Literal.String.Char */
.source .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.source .s2 { color: #BA2121 } /* Literal.String.Double */
.source .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.source .sh { color: #BA2121 } /* Literal.String.Heredoc */
.source .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.source .sx { color: #008000 } /* Literal.String.Other */
.source .sr { color: #BB6688 } /* Literal.String.Regex */
.source .s1 { color: #BA2121 } /* Literal.String.Single */
.source .ss { color: #19177C } /* Literal.String.Symbol */
.source .bp { color: #008000 } /* Name.Builtin.Pseudo */
.source .vc { color: #19177C } /* Name.Variable.Class */
.source .vg { color: #19177C } /* Name.Variable.Global */
.source .vi { color: #19177C } /* Name.Variable.Instance */
.source .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48664735-1', 'kylelk.github.io');
    ga('send', 'pageview');

    </script>
	</head>
<body>
<nav class="navbar navbar-default" role="navigation">
   <div class="navbar-header">
      <a class="navbar-brand" href="http://kylelk.github.io/kylekersey">Kyle Kersey</a>
   </div>
   <div>
      <ul class="nav navbar-nav">
         <li><a href="http://kylelk.github.io/kylekersey/code/index.html">Code</a></li>
         <li><a href="about/">About</a></li>
          <li><a href="contact/">Contact</a></li>
          <li><a href="work/">Work</a></li>
          <li><a href="http://kylelk.github.io/kylekersey/sitemap.html">Site Map</a></li>
      </ul>
   </div>
</nav>
<div class="main-area">
    <br>
    <b><a id="raw_link" href="raw/sha1.c">View Raw</a></b>
    <br>
    <br>
     <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://kylelk.github.io/kylekersey/code/sha1.c.html">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>   
    <br>
    <br>
    <table class="sourcetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239</pre></div></td><td class="code"><div class="source"><pre><span class="cm">/* from valgrind tests */</span>

<span class="cm">/* ================ sha1.c ================ */</span>
<span class="cm">/*</span>
<span class="cm">SHA-1 in C</span>
<span class="cm">By Steve Reid &lt;steve@edmweb.com&gt;</span>
<span class="cm">100% Public Domain</span>

<span class="cm">Test Vectors (from FIPS PUB 180-1)</span>
<span class="cm">&quot;abc&quot;</span>
<span class="cm">  A9993E36 4706816A BA3E2571 7850C26C 9CD0D89D</span>
<span class="cm">&quot;abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq&quot;</span>
<span class="cm">  84983E44 1C3BD26E BAAE4AA1 F95129E5 E54670F1</span>
<span class="cm">A million repetitions of &quot;a&quot;</span>
<span class="cm">  34AA973C D4C4DAA4 F61EEB2B DBAD2731 6534016F</span>
<span class="cm">*/</span>

<span class="cm">/* #define LITTLE_ENDIAN * This should be #define&#39;d already, if true. */</span>
<span class="cm">/* #define SHA1HANDSOFF * Copies data before messing with it. */</span>

<span class="cp">#define SHA1HANDSOFF</span>

<span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;sys/types.h&gt;	</span><span class="cm">/* for u_int*_t */</span><span class="cp"></span>

<span class="cm">/* ================ sha1.h ================ */</span>
<span class="cm">/*</span>
<span class="cm">SHA-1 in C</span>
<span class="cm">By Steve Reid &lt;steve@edmweb.com&gt;</span>
<span class="cm">100% Public Domain</span>
<span class="cm">*/</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">u_int32_t</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="kt">u_int32_t</span> <span class="n">count</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="p">}</span> <span class="n">SHA1_CTX</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">SHA1Transform</span><span class="p">(</span><span class="kt">u_int32_t</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<span class="kt">void</span> <span class="nf">SHA1Init</span><span class="p">(</span><span class="n">SHA1_CTX</span><span class="o">*</span> <span class="n">context</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">SHA1Update</span><span class="p">(</span><span class="n">SHA1_CTX</span><span class="o">*</span> <span class="n">context</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">u_int32_t</span> <span class="n">len</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">SHA1Final</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">digest</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">SHA1_CTX</span><span class="o">*</span> <span class="n">context</span><span class="p">);</span>
<span class="cm">/* ================ end of sha1.h ================ */</span>
<span class="cp">#include &lt;endian.h&gt;</span>

<span class="cp">#define rol(value, bits) (((value) &lt;&lt; (bits)) | ((value) &gt;&gt; (32 - (bits))))</span>

<span class="cm">/* blk0() and blk() perform the initial expand. */</span>
<span class="cm">/* I got the idea of expanding during the round function from SSLeay */</span>
<span class="cp">#if BYTE_ORDER == LITTLE_ENDIAN</span>
<span class="cp">#define blk0(i) (block-&gt;l[i] = (rol(block-&gt;l[i],24)&amp;0xFF00FF00) \</span>
<span class="cp">    |(rol(block-&gt;l[i],8)&amp;0x00FF00FF))</span>
<span class="cp">#elif BYTE_ORDER == BIG_ENDIAN</span>
<span class="cp">#define blk0(i) block-&gt;l[i]</span>
<span class="cp">#else</span>
<span class="cp">#error &quot;Endianness not defined!&quot;</span>
<span class="cp">#endif</span>
<span class="cp">#define blk(i) (block-&gt;l[i&amp;15] = rol(block-&gt;l[(i+13)&amp;15]^block-&gt;l[(i+8)&amp;15] \</span>
<span class="cp">    ^block-&gt;l[(i+2)&amp;15]^block-&gt;l[i&amp;15],1))</span>

<span class="cm">/* (R0+R1), R2, R3, R4 are the different operations used in SHA1 */</span>
<span class="cp">#define R0(v,w,x,y,z,i) z+=((w&amp;(x^y))^y)+blk0(i)+0x5A827999+rol(v,5);w=rol(w,30);</span>
<span class="cp">#define R1(v,w,x,y,z,i) z+=((w&amp;(x^y))^y)+blk(i)+0x5A827999+rol(v,5);w=rol(w,30);</span>
<span class="cp">#define R2(v,w,x,y,z,i) z+=(w^x^y)+blk(i)+0x6ED9EBA1+rol(v,5);w=rol(w,30);</span>
<span class="cp">#define R3(v,w,x,y,z,i) z+=(((w|x)&amp;y)|(w&amp;x))+blk(i)+0x8F1BBCDC+rol(v,5);w=rol(w,30);</span>
<span class="cp">#define R4(v,w,x,y,z,i) z+=(w^x^y)+blk(i)+0xCA62C1D6+rol(v,5);w=rol(w,30);</span>


<span class="cm">/* Hash a single 512-bit block. This is the core of the algorithm. */</span>

<span class="kt">void</span> <span class="nf">SHA1Transform</span><span class="p">(</span><span class="kt">u_int32_t</span> <span class="n">state</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">])</span>
<span class="p">{</span>
<span class="kt">u_int32_t</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
    <span class="kt">u_int32_t</span> <span class="n">l</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span> <span class="n">CHAR64LONG16</span><span class="p">;</span>
<span class="cp">#ifdef SHA1HANDSOFF</span>
<span class="n">CHAR64LONG16</span> <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>  <span class="cm">/* use array to appear as a pointer */</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
<span class="cp">#else</span>
    <span class="cm">/* The following had better never be used because it causes the</span>
<span class="cm">     * pointer-to-const buffer to be cast into a pointer to non-const.</span>
<span class="cm">     * And the result is written through.  I threw a &quot;const&quot; in, hoping</span>
<span class="cm">     * this will cause a diagnostic.</span>
<span class="cm">     */</span>
<span class="n">CHAR64LONG16</span><span class="o">*</span> <span class="n">block</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">CHAR64LONG16</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="cm">/* Copy context-&gt;state[] to working vars */</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="cm">/* 4 rounds of 20 operations each. Loop unrolled. */</span>
    <span class="n">R0</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">R0</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
    <span class="n">R0</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>
    <span class="n">R0</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">14</span><span class="p">);</span> <span class="n">R0</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span>
    <span class="n">R1</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span> <span class="n">R1</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">17</span><span class="p">);</span> <span class="n">R1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">18</span><span class="p">);</span> <span class="n">R1</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">19</span><span class="p">);</span>
    <span class="n">R2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">21</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">22</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">23</span><span class="p">);</span>
    <span class="n">R2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">24</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">25</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">26</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">27</span><span class="p">);</span>
    <span class="n">R2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">28</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">29</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">30</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">31</span><span class="p">);</span>
    <span class="n">R2</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">33</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">34</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">35</span><span class="p">);</span>
    <span class="n">R2</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">36</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">37</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">38</span><span class="p">);</span> <span class="n">R2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">39</span><span class="p">);</span>
    <span class="n">R3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">40</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">41</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">42</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">43</span><span class="p">);</span>
    <span class="n">R3</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">44</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">45</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">46</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">47</span><span class="p">);</span>
    <span class="n">R3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">48</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">49</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">51</span><span class="p">);</span>
    <span class="n">R3</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">52</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">53</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">54</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">55</span><span class="p">);</span>
    <span class="n">R3</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">56</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">57</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">58</span><span class="p">);</span> <span class="n">R3</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">59</span><span class="p">);</span>
    <span class="n">R4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">60</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">61</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">62</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">63</span><span class="p">);</span>
    <span class="n">R4</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">65</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">66</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">67</span><span class="p">);</span>
    <span class="n">R4</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">68</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">69</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">70</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">71</span><span class="p">);</span>
    <span class="n">R4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">72</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">73</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">74</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="mi">75</span><span class="p">);</span>
    <span class="n">R4</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">76</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">77</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">78</span><span class="p">);</span> <span class="n">R4</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">79</span><span class="p">);</span>
    <span class="cm">/* Add the working vars back into context.state[] */</span>
    <span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
    <span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="n">e</span><span class="p">;</span>
    <span class="cm">/* Wipe variables */</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="n">d</span> <span class="o">=</span> <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef SHA1HANDSOFF</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="sc">&#39;\0&#39;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">block</span><span class="p">));</span>
<span class="cp">#endif</span>
<span class="p">}</span>


<span class="cm">/* SHA1Init - Initialize new context */</span>

<span class="kt">void</span> <span class="nf">SHA1Init</span><span class="p">(</span><span class="n">SHA1_CTX</span><span class="o">*</span> <span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* SHA1 initialization constants */</span>
    <span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x67452301</span><span class="p">;</span>
    <span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xEFCDAB89</span><span class="p">;</span>
    <span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x98BADCFE</span><span class="p">;</span>
    <span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10325476</span><span class="p">;</span>
    <span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xC3D2E1F0</span><span class="p">;</span>
    <span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Run your data through this. */</span>

<span class="kt">void</span> <span class="nf">SHA1Update</span><span class="p">(</span><span class="n">SHA1_CTX</span><span class="o">*</span> <span class="n">context</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">u_int32_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
<span class="kt">u_int32_t</span> <span class="n">i</span><span class="p">;</span>
<span class="kt">u_int32_t</span> <span class="n">j</span><span class="p">;</span>

    <span class="n">j</span> <span class="o">=</span> <span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">len</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">)</span>
	<span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">len</span><span class="o">&gt;&gt;</span><span class="mi">29</span><span class="p">);</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">63</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">j</span> <span class="o">+</span> <span class="n">len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">63</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">64</span><span class="o">-</span><span class="n">j</span><span class="p">));</span>
        <span class="n">SHA1Transform</span><span class="p">(</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">,</span> <span class="n">context</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">63</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">SHA1Transform</span><span class="p">(</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">len</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* Add padding and return the message digest. */</span>

<span class="kt">void</span> <span class="nf">SHA1Final</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">digest</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">SHA1_CTX</span><span class="o">*</span> <span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
<span class="kt">unsigned</span> <span class="n">i</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">finalcount</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>

<span class="cp">#if 0</span><span class="c">	/* untested &quot;improvement&quot; by DHR */</span>
<span class="c">    /* Convert context-&gt;count to a sequence of bytes</span>
<span class="c">     * in finalcount.  Second element first, but</span>
<span class="c">     * big-endian order within element.</span>
<span class="c">     * But we do it all backwards.</span>
<span class="c">     */</span>
<span class="c">    unsigned char *fcp = &amp;finalcount[8];</span>

<span class="c">    for (i = 0; i &lt; 2; i++)</span>
<span class="c">    {</span>
<span class="c">	u_int32_t t = context-&gt;count[i];</span>
<span class="c">	int j;</span>

<span class="c">	for (j = 0; j &lt; 4; t &gt;&gt;= 8, j++)</span>
<span class="c">	    *--fcp = (unsigned char) t</span>
<span class="c">    }</span>
<span class="cp">#else</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">finalcount</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)((</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)]</span>
         <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="mi">3</span><span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">);</span>  <span class="cm">/* Endian independent */</span>
    <span class="p">}</span>
<span class="cp">#endif</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mo">0200</span><span class="p">;</span>
    <span class="n">SHA1Update</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">504</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">448</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">c</span> <span class="o">=</span> <span class="mo">0000</span><span class="p">;</span>
        <span class="n">SHA1Update</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">SHA1Update</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">finalcount</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>  <span class="cm">/* Should cause a SHA1Transform() */</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">digest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span>
         <span class="p">((</span><span class="n">context</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="mi">3</span><span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* Wipe variables */</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="sc">&#39;\0&#39;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">context</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">finalcount</span><span class="p">,</span> <span class="sc">&#39;\0&#39;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">finalcount</span><span class="p">));</span>
<span class="p">}</span>
<span class="cm">/* ================ end of sha1.c ================ */</span>

<span class="cp">#define BUFSIZE 4096</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SHA1_CTX</span> <span class="n">ctx</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hash</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFSIZE</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">BUFSIZE</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">SHA1Init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">1000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">SHA1Update</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUFSIZE</span><span class="p">);</span>
    <span class="n">SHA1Final</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctx</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;SHA1=&quot;</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%02x&quot;</span><span class="p">,</span> <span class="n">hash</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
    <br>
    <br>     
</div>
    <div class="page-links">
   
   </div>
</body>
</html>